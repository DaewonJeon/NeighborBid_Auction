{% extends 'auctions/base.html' %}

{% block content %}
<div class="row">
    <div class="col-md-3">
        <div class="card shadow-sm p-3 mb-4">
            <h5 class="fw-bold mb-3">ğŸ” í•„í„°</h5>
            
            <h6 class="fw-bold mt-2">ğŸ—ºï¸ ì§€ì—­</h6>
            <div class="list-group list-group-flush mb-3 scrollable-menu" style="max-height: 300px; overflow-y: auto;">
                <a href="?{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}sort={{ sort }}" 
                   class="list-group-item list-group-item-action {% if not selected_region %}active{% endif %}">
                   ì „ì²´ ì§€ì—­
                </a>
                {% for region in all_regions %}
                    <a href="?region={{ region.id }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}&sort={{ sort }}" 
                       class="list-group-item list-group-item-action {% if selected_region.id == region.id %}active{% endif %}"
                       style="padding-left: {{ region.depth|add:'-1'|add:'1' }}rem;"> 
                       {% if region.depth > 1 %}â”” {% endif %}
                       {{ region.name }}
                    </a>
                {% endfor %}
            </div>

            <h6 class="fw-bold mt-2">ğŸ“¦ ì¹´í…Œê³ ë¦¬</h6>
            <div class="list-group list-group-flush mb-3">
                <a href="?{% if request.GET.region %}region={{ request.GET.region }}&{% endif %}sort={{ sort }}" 
                   class="list-group-item list-group-item-action {% if not request.GET.category %}active{% endif %}">
                   ì „ì²´ ì¹´í…Œê³ ë¦¬
                </a>
                {% for cat in all_categories %}
                    <a href="?category={{ cat.slug }}{% if request.GET.region %}&region={{ request.GET.region }}{% endif %}&sort={{ sort }}" 
                       class="list-group-item list-group-item-action {% if request.GET.category == cat.slug %}active{% endif %}">
                       {{ cat.name }}
                    </a>
                {% endfor %}
            </div>

            <h6 class="fw-bold mt-2">ğŸ’° ê°€ê²© ë²”ìœ„</h6>
            <form method="get">
                {% if request.GET.region %}<input type="hidden" name="region" value="{{ request.GET.region }}">{% endif %}
                {% if request.GET.category %}<input type="hidden" name="category" value="{{ request.GET.category }}">{% endif %}
                <input type="hidden" name="sort" value="{{ sort }}">

                <div class="input-group mb-2">
                    <input type="number" name="min_price" class="form-control" placeholder="ìµœì†Œ" value="{{ request.GET.min_price }}">
                </div>
                <div class="input-group mb-2">
                    <input type="number" name="max_price" class="form-control" placeholder="ìµœëŒ€" value="{{ request.GET.max_price }}">
                </div>
                <button type="submit" class="btn btn-primary w-100 btn-sm">ê°€ê²© ì ìš©</button>
            </form>
            <div class="mt-2 text-end">
                <a href="{% url 'auction_list' %}" class="text-muted small text-decoration-none">ğŸ”„ í•„í„° ì´ˆê¸°í™”</a>
            </div>
        </div>
    </div>

    <div class="col-md-9">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3>
                {% if selected_region %}
                    {{ selected_region.name }}
                {% else %}
                    ì „ì²´ ì§€ì—­
                {% endif %}
                <span class="text-muted fs-6">ì¤‘ê³ ê±°ë˜</span>
            </h3>
            
            <div class="btn-group">
                <a href="?sort=recent{% if request.GET.region %}&region={{ request.GET.region }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" class="btn btn-sm btn-outline-dark {% if sort == 'recent' %}active{% endif %}">ìµœì‹ ìˆœ</a>
                <a href="?sort=end_soon{% if request.GET.region %}&region={{ request.GET.region }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" class="btn btn-sm btn-outline-dark {% if sort == 'end_soon' %}active{% endif %}">ë§ˆê°ìˆœ</a>
                <a href="?sort=price_asc{% if request.GET.region %}&region={{ request.GET.region }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" class="btn btn-sm btn-outline-dark {% if sort == 'price_asc' %}active{% endif %}">ì €ê°€ìˆœ</a>
            </div>
        </div>

        <div class="row">
            {% for auction in auctions %}
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm hover-shadow">
                    <div class="position-relative">
                        {% if auction.image %}
                            <img src="{{ auction.image.url }}" class="card-img-top" alt="{{ auction.title }}" style="height: 200px; object-fit: cover;">
                        {% else %}
                            <div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height: 200px;">ì´ë¯¸ì§€ ì—†ìŒ</div>
                        {% endif %}
                        <span class="position-absolute top-0 end-0 badge bg-dark m-2">{{ auction.get_status_display }}</span>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title text-truncate">{{ auction.title }}</h5>
                        <p class="card-text text-danger fw-bold">{{ auction.current_price }}ì›</p>
                        <div class="d-flex justify-content-between small text-muted">
                            <span>ğŸ“ {{ auction.region.name|default:"ì§€ì—­ì—†ìŒ" }}</span>
                            <span>â± {{ auction.end_time|timeuntil }} ë‚¨ìŒ</span>
                        </div>
                    </div>
                    <a href="{% url 'auction_detail' auction.id %}" class="stretched-link"></a>
                </div>
            </div>
            {% empty %}
            <div class="col-12 py-5 text-center">
                <h4 class="text-muted">ì¡°ê±´ì— ë§ëŠ” ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤. í……! ğŸ—‘ï¸</h4>
                <a href="{% url 'auction_list' %}" class="btn btn-outline-primary mt-3">ì „ì²´ ë³´ê¸°</a>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}